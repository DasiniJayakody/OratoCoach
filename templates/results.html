{% extends "base.html" %}

{% block title %}Analysis Results - OratoCoach{% endblock %}

{% block content %}
<div class="container py-5">
    <div class="row justify-content-center">
        <div class="col-lg-10">
            <div class="text-center mb-5">
                <h1 class="display-4 fw-bold mb-3">Analysis Results</h1>
                <p class="lead text-muted">
                    Your presentation analysis is complete! Review your results below.
                </p>
            </div>
            
            {% if results.has_face_data or results.has_hands_data or results.has_pose_data %}
                <!-- Executive Summary -->
                <div class="card mb-5">
                    <div class="card-header bg-primary text-white">
                        <h3 class="card-title mb-0">
                            <i class="fas fa-chart-line me-2"></i>Executive Summary
                        </h3>
                    </div>
                    <div class="card-body">
                        <div class="row g-4">
                            {% if results.has_face_data %}
                            <div class="col-md-4">
                                <div class="metric-card text-center">
                                    <div class="metric-icon text-primary mb-2">
                                        <i class="fas fa-eye fa-2x"></i>
                                    </div>
                                    <h4 class="fw-bold">{{ "%.1f"|format(results.face_data.eye_contact_percentage) }}%</h4>
                                    <p class="text-muted mb-0">Eye Contact</p>
                                </div>
                            </div>
                            {% endif %}
                            
                            {% if results.has_hands_data %}
                            <div class="col-md-4">
                                <div class="metric-card text-center">
                                    <div class="metric-icon text-success mb-2">
                                        <i class="fas fa-hands fa-2x"></i>
                                    </div>
                                    <h4 class="fw-bold">{{ results.hands_data.total_gestures }}</h4>
                                    <p class="text-muted mb-0">Gestures Detected</p>
                                </div>
                            </div>
                            {% endif %}
                            
                            {% if results.has_pose_data %}
                            <div class="col-md-4">
                                <div class="metric-card text-center">
                                    <div class="metric-icon text-warning mb-2">
                                        <i class="fas fa-user-tie fa-2x"></i>
                                    </div>
                                    <h4 class="fw-bold">{{ "%.1f"|format(results.pose_data.average_posture_score) }}%</h4>
                                    <p class="text-muted mb-0">Posture Score</p>
                                </div>
                            </div>
                            {% endif %}
                        </div>
                    </div>
                </div>
                
                <!-- Detailed Results -->
                {% if results.has_face_data %}
                <div class="card mb-4">
                    <div class="card-header">
                        <h4 class="card-title mb-0">
                            <i class="fas fa-eye me-2 text-primary"></i>Face Analysis Results
                        </h4>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-8">
                                <table class="table table-borderless">
                                    <tr>
                                        <td><strong>Total Frames Analyzed:</strong></td>
                                        <td>{{ results.face_data.total_frames }}</td>
                                    </tr>
                                    <tr>
                                        <td><strong>Good Eye Contact Frames:</strong></td>
                                        <td>{{ results.face_data.good_eye_contact_frames }}</td>
                                    </tr>
                                    <tr>
                                        <td><strong>Average Score:</strong></td>
                                        <td>{{ "%.1f"|format(results.face_data.average_score) }}%</td>
                                    </tr>
                                    <tr>
                                        <td><strong>Eye Contact Percentage:</strong></td>
                                        <td>{{ "%.1f"|format(results.face_data.eye_contact_percentage) }}%</td>
                                    </tr>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
                {% endif %}
                
                {% if results.has_hands_data %}
                <div class="card mb-4">
                    <div class="card-header">
                        <h4 class="card-title mb-0">
                            <i class="fas fa-hands me-2 text-success"></i>Hands Analysis Results
                        </h4>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-6">
                                <table class="table table-borderless">
                                    <tr>
                                        <td><strong>Total Frames Analyzed:</strong></td>
                                        <td>{{ results.hands_data.total_frames }}</td>
                                    </tr>
                                    <tr>
                                        <td><strong>Frames with Hands:</strong></td>
                                        <td>{{ results.hands_data.frames_with_hands }}</td>
                                    </tr>
                                    <tr>
                                        <td><strong>Total Gestures:</strong></td>
                                        <td>{{ results.hands_data.total_gestures }}</td>
                                    </tr>
                                </table>
                            </div>
                            <div class="col-md-6">
                                <h6 class="fw-bold">Gesture Breakdown:</h6>
                                <ul class="list-unstyled">
                                    {% for gesture, percentage in results.hands_data.gesture_percentages.items() %}
                                    <li>{{ gesture.replace('_', ' ').title() }}: {{ "%.1f"|format(percentage) }}%</li>
                                    {% endfor %}
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
                {% endif %}
                
                {% if results.has_pose_data %}
                <div class="card mb-4">
                    <div class="card-header">
                        <h4 class="card-title mb-0">
                            <i class="fas fa-user-tie me-2 text-warning"></i>Pose Analysis Results
                        </h4>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-8">
                                <table class="table table-borderless">
                                    <tr>
                                        <td><strong>Total Frames Analyzed:</strong></td>
                                        <td>{{ results.pose_data.total_frames }}</td>
                                    </tr>
                                    <tr>
                                        <td><strong>Good Posture Frames:</strong></td>
                                        <td>{{ results.pose_data.good_posture_frames }}</td>
                                    </tr>
                                    <tr>
                                        <td><strong>Average Posture Score:</strong></td>
                                        <td>{{ "%.1f"|format(results.pose_data.average_posture_score) }}%</td>
                                    </tr>
                                    <tr>
                                        <td><strong>Movement Positions:</strong></td>
                                        <td>{{ results.pose_data.movement_positions|length }} recorded</td>
                                    </tr>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
                {% endif %}
                
                <!-- Actions -->
                <div class="text-center">
                    <button class="btn btn-success btn-lg me-3" onclick="generateReport()">
                        <i class="fas fa-file-pdf me-2"></i>Generate PDF Report
                    </button>
                    <a href="{{ url_for('analysis') }}" class="btn btn-outline-primary btn-lg">
                        <i class="fas fa-redo me-2"></i>New Analysis
                    </a>
                </div>
                
            {% else %}
                <div class="alert alert-warning text-center">
                    <h4>No Analysis Data Available</h4>
                    <p class="mb-3">Please complete an analysis first to view results.</p>
                    <a href="{{ url_for('analysis') }}" class="btn btn-primary">
                        <i class="fas fa-play me-2"></i>Start Analysis
                    </a>
                </div>
            {% endif %}
        </div>
    </div>
</div>

<script>
function generateReport() {
    fetch('/generate_pdf')
        .then(response => response.json())
        .then(data => {
            if (data.status === 'success') {
                alert('PDF report generated successfully!');
                window.location.href = '/download_pdf';
            } else {
                alert('Error generating PDF: ' + data.message);
            }
        })
        .catch(error => {
            console.error('Error:', error);
            alert('An error occurred while generating the PDF.');
        });
}
</script>
{% endblock %}